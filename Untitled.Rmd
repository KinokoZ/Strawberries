---
title: "Assignment 1"
author: "Jinran Li"
date: "2024-10-02"
output: html_document
---

```{r}
#| label: load libraries and set options
#| warning: false
#| message: false
#| 

library(knitr)  
library(kableExtra)
library(tidyverse)

```


```{r}
#| label: read data - glimpse 

strawberry <- read_csv("strawberries25_v3.csv", col_names = TRUE)

glimpse(strawberry)
```
```{r}

strawberry <- strawberry %>%
  mutate(Value = as.numeric(str_replace_all(Value, "[^0-9\\.]", NA_character_)))

str(strawberry$Value)
head(strawberry$Value)

```


```{r}
na_county <- top4_county_acres %>%
  filter(is.na(County))

# 检查 `Total_Acres` 中的 `NA` 值
na_total_acres <- top4_county_acres %>%
  filter(is.na(Total_Acres) | Total_Acres == 0)

# 输出结果，查看 `NA` 情况
print("Missing Counties:")
print(na_county)

print("Missing or Zero Acreage Data:")
print(na_total_acres)


```
```{r}
top2_states_all_types <- state_county_acres %>%
  filter(State %in% c("CALIFORNIA", "FLORIDA")) %>%
  group_by(State, Type) %>%
  top_n(5, wt = Total_Acres) %>%
  ungroup()

# 绘制包含两种类型的柱状图
ggplot(top2_states_all_types, aes(x = reorder(County, -Total_Acres), y = Total_Acres, fill = Type)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip() +  # 使用横向柱状图
  facet_wrap(~ State, scales = "free") +
  labs(title = "Top Counties in Major Strawberry Producing States (California and Florida)",
       x = "County",
       y = "Total Acreage",
       fill = "Type") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 1),  # 调整横向标签格式
        panel.spacing = unit(1, "lines"))  # 增加子图之间的间隔
```
```{r}

# 加州和佛州主要县的草莓总种植面积
county_acreage_proportion <- county_acreage_proportion %>%
  filter(County %in% c("SANTA BARBARA", "VENTURA", "MIAMI-DADE", "HILLSBOROUGH", "PASCO", "POLK", "ORANGE"))  # 选择前几个县

# 绘制条形图，并使用 facet_wrap 分面展示
ggplot(county_acreage_proportion, aes(x = reorder(County, -Percentage), y = Percentage, fill = County)) +
  geom_bar(stat = "identity") +
  coord_flip() +  # 旋转条形图
  facet_wrap(~ State, scales = "free") +
  labs(title = "Proportion of Strawberry Acreage by Major Counties in California and Florida",
       x = "County",
       y = "Proportion (%)",
       fill = "County") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5))  # 中心对齐标题

```

